<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>StrataGEN - A random stratagem loadout generator for Helldivers</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #808080;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5vw;
      width: 90vw;
      max-width: 1200px;
      margin-top: 20px;
    }

    .grid div {
      background-color: gray;
      border-radius: 8px;
      overflow: hidden;
      aspect-ratio: 1 / 1;
      cursor: pointer;
    }

    .grid img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      user-select: none;
      pointer-events: none;
      display: block;
    }

    .grid-element {
      border-width: 2px;
      border-style: solid;
      border-color: #FFE900;
      border-radius: 0;
    }

    .locked {
      pointer-events: none;
      opacity: 0.5;
    }

    button {
      margin: 20px 10px 0;
      padding: 0.7em 1.5em;
      font-size: 1.1rem;
      background-color: #FFE900;
      color: #000000;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }

    button:hover {
      background-color: #ba6d00;
    }

    #dismiss-button {
      position: absolute;
      top: -15px; /* slightly above the picker */
      left: 50%; /* center horizontally */
      transform: translateX(-50%);
      padding: 0.5em 1em;
      background-color: #FFE900;
      color: black;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      z-index: 10;
    }

    /*#stratagem-picker {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      height: 60%;
      background: #666;
      transition: bottom 0.3s ease-out;
      overflow-y: auto;
      z-index: 10;
      padding: 20px;
    }*/

    #stratagem-picker {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      max-height: 90vh;
      background: #606060;
      padding: 20px;
      box-sizing: border-box;
      transition: bottom 0.3s ease;
      overflow-y: auto;
      z-index: 1000;
    }

    #stratagem-picker.visible {
      bottom: 0;
    }

    .stratagem-picker-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1vw;
      width: 50vw;
    }

    .stratagem-picker-element {
      background-color: gray;
      border: 2px solid #FFE900;
      aspect-ratio: 1 / 1;
      overflow: hidden;
      position: relative;
      cursor: pointer;
    }

    .stratagem-picker-element[isLocked="true"] {
      opacity: 0.5;
    }

    .stratagem-picker-element img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none;
      user-select: none;
    }

    @media (max-width: 600px) {
      .grid {
        
        width: 50vw;
        gap: 1vw;
      }
      button {
        font-size: 1rem;
        padding: 0.6em 1.2em;
      }
    }
  </style>
</head>
<body>

  <div class="grid">
    <div class="grid-element"><img src="" alt="" /></div>
    <div class="grid-element"><img src="" alt="" /></div>
    <div class="grid-element"><img src="" alt="" /></div>
    <div class="grid-element"><img src="" alt="" /></div>
  </div>

  <div>
    <button onclick="shuffleImages()">Shuffle Stratagems</button>
    <button onclick="showStratagemBoard()">Toggle Stratagems</button>
  </div>

  <div id="stratagem-picker">
    <div class="stratagem-picker-grid" id="pickerGrid"></div>
    <button id="dismiss-button" onclick="dismissStratagemBoard()">&#x25BC;</button>
  </div>

  <script>
    const imageElements = document.querySelectorAll('.grid-element img');
    const gridDivs = document.querySelectorAll('.grid-element');
    const pickerGrid = document.getElementById('pickerGrid');
    const pickerPanel = document.getElementById('stratagem-picker');
    let lockedGridIndices = new Set();
    let lockedStratagems = new Set();

    const allImages = [
      'AM-23_EMS_Mortar_Sentry_Stratagem_Icon.png',
      'Anti-Materiel_Rifle_Stratagem_Icon.png',
      'Anti-Personnel_Minefield_Stratagem_Icon.png',
      'Arc_Thrower_Stratagem_Icon.png',
      'Autocannon_Sentry_Stratagem_Icon.png',
      'Autocannon_Stratagem_Icon.png',
      'A_FLAM-40_Flame_Sentry_Stratagem_Icon.png',
      'Ballistic_Shield_Backpack_Stratagem_Icon.png',
      'Commando_Stratagem_Icon.png',
      'CQC-1_One_True_Flag_Stratagem_Icon.png',
      'Eagle_110mm_Rocket_Pods_Stratagem_Icon.png',
      'Eagle_500kg_Bomb_Stratagem_Icon.png',
      'Eagle_Airstrike_Stratagem_Icon.png',
      'Eagle_Cluster_Bomb_Stratagem_Icon.png',
      'Eagle_Napalm_Airstrike_Stratagem_Icon.png',
      'Eagle_Smoke_Strike_Stratagem_Icon.png',
      'Eagle_Strafing_Run_Stratagem_Icon.png',
      'EXO-45_Patriot_Exosuit_Stratagem_Icon.png',
      'EXO-49_Emancipator_Exosuit_Stratagem_Icon.png',
      'Expendable_Anti-Tank_Stratagem_Icon.png',
      'E_AT-12_Anti-Tank_Emplacement_Stratagem_Icon.png',
      'Flamethrower_Stratagem_Icon.png',
      'Gas_Minefield_Stratagem_Icon.png',
      'Gatling_Sentry_Stratagem_Icon.png',
      'GL-21_Grenadier_Battlement_Stratagem_Icon.png',
      'Grenade_Launcher_Stratagem_Icon.png',
      'Guard_Dog_Dog_Breath_Stratagem_Icon.png',
      'Guard_Dog_Rover_Stratagem_Icon.png',
      'Guard_Dog_Stratagem_Icon.png',
      'Heavy_Machine_Gun_Stratagem_Icon.png',
      'HMG_Emplacement_Stratagem_Icon.png',
      'Hover_Pack_Stratagem_Icon.png',
      'Incendiary_Mines_Stratagem_Icon.png',
      'Jump_Pack_Stratagem_Icon.png',
      'Laser_Cannon_Stratagem_Icon.png',
      'M-102_Fast_Recon_Vehicle_Stratagem_Icon.png',
      'Machine_Gun_Sentry_Stratagem_Icon.png',
      'Machine_Gun_Stratagem_Icon.png',
      'MD-17_Anti-Tank_Mines_Stratagem_Icon.png',
      'Mortar_Sentry_Stratagem_Icon.png',
      'Orbital_120mm_HE_Barrage_Stratagem_Icon.png',
      'Orbital_380mm_HE_Barrage_Stratagem_Icon.png',
      'Orbital_Airburst_Strike_Stratagem_Icon.png',
      'Orbital_EMS_Strike_Stratagem_Icon.png',
      'Orbital_Gas_Strike_Stratagem_Icon.png',
      'Orbital_Gatling_Barrage_Stratagem_Icon.png',
      'Orbital_Laser_Stratagem_Icon.png',
      'Orbital_Napalm_Barrage_Stratagem_Icon.png',
      'Orbital_Precision_Strike_Stratagem_Icon.png',
      'Orbital_Railcannon_Strike_Stratagem_Icon.png',
      'Orbital_Smoke_Strike_Stratagem_Icon.png',
      'Orbital_Walking_Barrage_Stratagem_Icon.png',
      'Portable_Hellbomb_Stratagem_Icon.png',
      'Quasar_Cannon_Stratagem_Icon.png',
      'Railgun_Stratagem_Icon.png',
      'Recoilless_Rifle_Stratagem_Icon.png',
      'RL-77_Airburst_Rocket_Launcher_Stratagem_Icon.png',
      'Rocket_Sentry_Stratagem_Icon.png',
      'SH-51_Directional_Shield_Stratagem_Icon.png',
      'Shield_Generator_Pack_Stratagem_Icon.png',
      'Shield_Generator_Relay_Stratagem_Icon.png',
      'Spear_Stratagem_Icon.png',
      'StA-X3_W.A.S.P._Launcher_Stratagem_Icon.png',
      'Stalwart_Stratagem_Icon.png',
      'Sterilizer_Stratagem_Icon.png',
      'Supply_Pack_Stratagem_Icon.png',
      'Tesla_Tower_Stratagem_Icon.png'
    ];

    // Attach lock toggle on grid element click
    gridDivs.forEach((div, index) => {
      div.addEventListener('click', () => {
        const img = div.querySelector('img');
        if (img.src && !lockedGridIndices.has(index)) {
          lockedGridIndices.add(index);
          div.classList.add('locked');
        }
      });
    });

    function getRandomImages(arr, count, exclude = []) {
      const available = arr.filter(i => !exclude.includes(i));
      const shuffled = [...available].sort(() => 0.5 - Math.random());
      return shuffled.slice(0, count);
    }

    function shuffleImages() {
      const usedImages = Array.from(imageElements).map(img => img.src.split('/').pop());
      const excludeImages = [...lockedStratagems, ...usedImages.filter((_, idx) => lockedGridIndices.has(idx))];
      const newImages = getRandomImages(allImages, 4 - lockedGridIndices.size, excludeImages);

      let newIdx = 0;
      imageElements.forEach((img, idx) => {
        if (!lockedGridIndices.has(idx)) {
          img.src = `stratagems/${newImages[newIdx++]}`;
        }
      });
    }

    function showStratagemBoard() {
      pickerGrid.innerHTML = '';
      lockedStratagems.clear();
      allImages.forEach(filename => {
        const div = document.createElement('div');
        div.className = 'stratagem-picker-element';
        div.setAttribute('isLocked', 'false');
        div.innerHTML = `<img src="stratagems/${filename}" alt="">`;
        div.addEventListener('click', () => {
          const current = div.getAttribute('isLocked') === 'true';
          div.setAttribute('isLocked', String(!current));
          if (current) {
            lockedStratagems.delete(filename);
          } else {
            lockedStratagems.add(filename);
          }
        });
        pickerGrid.appendChild(div);
      });
      pickerPanel.classList.add('visible');
    }

    function dismissStratagemBoard() {
      const total = allImages.length;
      const unlocked = total - lockedStratagems.size;
      if (unlocked < 4) {
        alert('You must have at least 4 unlocked stratagems.');
        return;
      }
      pickerPanel.classList.remove('visible');
    }

    window.onload = shuffleImages;
  </script>

</body>
</html>
